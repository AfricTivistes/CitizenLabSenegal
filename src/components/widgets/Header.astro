---
import { Icon } from "astro-icon/components";
import Logo from "~/components/Logo.astro";
import ToggleMenu from "~/components/common/ToggleMenu.astro";
import Button from "~/components/ui/Button.astro"
import { getHomePermalink, trimSlash } from "~/utils/permalinks";
import type { CallToAction } from "~/types";

interface Link {
Â  text?: string;
Â  href?: string;
}

interface ActionLink extends CallToAction {}

interface MenuLink extends Link {
Â  links?: Array<MenuLink>;
}

export interface Props {
Â  id?: string;
Â  links?: Array<MenuLink>;
Â  actions?: Array<ActionLink>;
Â  isSticky?: boolean;
Â  isDark?: boolean;
Â  isFullWidth?: boolean;
Â  position?: string;
}

const {
Â  id = "header",
Â  links = [], 
Â  actions = [],
Â  isSticky = false,
Â  isDark = false,
Â  isFullWidth = false,
Â  position = "center",
} = Astro.props;

const currentPath = `/${trimSlash(new URL(Astro.url).pathname)}`

---

<header
Â  class:list={[
Â  Â  { sticky: isSticky, relative: !isSticky, dark: isDark },
Â  Â  "top-0 z-40 flex-none mx-auto w-full border-b border-gray-50/0 transition-[opacity] ease-in-out",
Â  ]}
Â  {...id ? { id } : {}}
>
Â  <div class="absolute inset-0"></div>
Â  <div
Â  Â  class:list={[
Â  Â  Â  "relative text-default py-3 px-3 md:px-6 mx-auto w-full md:flex md:justify-between",
Â  Â  Â  {
Â  Â  Â  Â  "max-w-7xl": !isFullWidth,
Â  Â  Â  },
Â  Â  ]}
Â  >
Â  Â  <div class:list={[{ "mr-auto rtl:mr-0 rtl:ml-auto": position === "right" }, "flex justify-between"]}>
Â  Â  Â  <a class="flex items-center" href={getHomePermalink()}>
Â  Â  Â  Â  <Logo />
Â  Â  Â  </a>
Â  Â  Â  <div class="flex items-center md:hidden">
Â  Â  Â  Â  <ToggleMenu />
Â  Â  Â  </div>
Â  Â  </div>
Â  Â  
Â  Â  <nav
Â  Â  Â  class="items-center w-full md:w-auto hidden md:!flex text-default overflow-y-auto overflow-x-hidden md:overflow-y-visible md:overflow-x-auto md:mx-5"
Â  Â  Â  aria-label="Main navigation"
Â  Â  >
Â  Â    <ul
    class="flex flex-col md:flex-row md:self-center w-full md:w-auto text-xl md:text-[0.9375rem] tracking-[0.01rem] font-medium"
>
    {
        Array.isArray(links) && links.map(({ text, href, links: childItems = [] }) => {
            
            // Logique d'activation : VÃ©rifie si le chemin actuel est dans les liens enfants.
            const isChildActive = Array.isArray(childItems) && childItems.some(
                (child) => (child.href && currentPath) ? child.href === currentPath : false
            );
            
            return (
                // Le LI utilise "aw-link-active" (pour le fond s'il y en avait un)
                <li class:list={[{ 
                    "dropdown": childItems.length > 0, 
                    "aw-link-active": isChildActive 
                }, "group"]}>
                    {Array.isArray(childItems) && childItems.length > 0 ? (
                        <>
                            <a href={href || '#'} >
                                {/* ðŸŽ¯ APPLICATION DU STYLE AU BUTTON qui a le PADDING */}
                                <button 
                                    class:list={[
                                        "hover:text-link dark:hover:text-white px-4 py-3 flex items-center", 
                                        { "aw-link-active-text": isChildActive } // ðŸ‘ˆ NOUVELLE CLASSE DE STYLE
                                    ]}
                                >
                                    {text} <Icon name="tabler:chevron-down" class="w-3.5 h-3.5 ml-0.5 rtl:ml-0 rtl:mr-0.5 hidden md:inline" />
                                </button>
                            </a>
                            
                            <ul class="dropdown-menu md:backdrop-blur-md dark:md:bg-dark rounded md:absolute pl-4 md:pl-0 font-medium md:bg-white/90 md:min-w-[200px] drop-shadow-xl 
                                md:!hidden
                                group-hover:md:!block
                            ">
                                {childItems.map(({ text: text2 = '', href: href2 = '' }) => (
                                    <li>
                                        <a
                                            class:list={[
                                                "first:rounded-t last:rounded-b md:hover:bg-gray-100 hover:text-link dark:hover:text-white dark:hover:bg-gray-700 py-2 px-5 block whitespace-no-wrap",
                                                { "aw-link-active-text" : (href2 && currentPath) ? href2 === currentPath : false} // ðŸ‘ˆ NOUVELLE CLASSE
                                            ]}
                                            href={href2}
                                        >
                                            {text2}
                                        </a>
                                    </li>
                                ))}
                            </ul>
                        </>
                    ) : (
                        <a
                            class:list={[
                                "hover:text-link dark:hover:text-white px-4 py-3 flex items-centers",
                                { "aw-link-active-text": (href && currentPath) ? href === currentPath : false } // ðŸ‘ˆ NOUVELLE CLASSE
                            ]}
                            href={href}
                        >
                            {text}
                        </a>
                    )}
                </li>
            );
        })
    }
</ul>
Â  Â  Â 
Â  Â  </nav>
Â  Â  
Â  Â  <div
Â  Â  Â  class:list={[
Â  Â  Â  Â  { "ml-auto rtl:ml-0 rtl:mr-auto": position === "left" },
Â  Â  Â  Â  "hidden md:self-center flex md:flex items-center md:mb-0 fixed w-full md:w-auto md:static justify-end left-0 rtl:left-auto rtl:right-0 bottom-0 p-3 md:p-0",
Â  Â  Â  ]}
Â  Â  >
Â  Â  Â  <div class="items-center flex justify-between w-full md:w-auto">
Â  Â  Â  Â  {
Â  Â  Â  Â  Â  Array.isArray(actions) && actions.length > 0 && (
Â  Â  Â  Â  Â  Â  <span class="ml-4 rtl:ml-0 rtl:mr-4">
Â  Â  Â  Â  Â  Â  Â  {actions.map((btnProps) => (
Â  Â  Â  Â  Â  Â  Â  Â  <Button {...btnProps} class="ml-2 py-2.5 px-5.5 md:px-6 font-semibold shadow-none text-sm w-auto"/>
Â  Â  Â  Â  Â  Â  Â  ))}
Â  Â  Â  Â  Â  Â  </span>
Â  Â  Â  Â  Â  )
Â  Â  Â  Â  }
Â  Â  Â  </div>
Â  Â  </div>
Â  </div>
</header>
