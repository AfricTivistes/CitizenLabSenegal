---
import Layout from "~/layouts/PageLayout.astro";
import { getCollection, getEntry } from "astro:content";
import { GoArrowUpRight } from "react-icons/go";

export async function getStaticPaths() {
  const articles = await getCollection("news");

  return articles.map((article) => ({
    params: { slug: article.slug },
  }));
}

const { slug } = Astro.params;

const autresArticles = await getCollection("news");

// charge l’article depuis la collection "news"
const article = await getEntry("news", slug);

if (!article) {
  throw new Error("Article introuvable");
}

// Rendu du contenu markdown en html
const {Content} = await article.render();
---

<Layout
  metadata={{ title: article.data.title }}
>
  <main class="mx-auto py-16 bg-[#fcfcfc]">
    <div class="max-w-4xl mx-auto text-center mb-12 space-y-6">
      <span
        class="text-base font-semibold text-green-900 mb-2 border border-green-900 px-4 py-3 rounded-full"
        >{article.data.category}</span
      >
      <h2 class="text-5xl font-bold mb-6 text-green-900">
        {article.data.title}
      </h2>
      <p class="text-sm text-center text-green-900 mb-8">
        • Publié le {
          new Date(article.data.date).toLocaleDateString("fr-FR", {
            year: "numeric",
            month: "long",
            day: "numeric",
          })
        } 
      </p>
    </div>

    <div class="max-w-4xl mx-auto mb-12">
    {
      article.data.image && (
        <div class="mb-8">
          <img
            src={article.data.image}
            alt={article.data.title}
            class="w-full h-auto rounded-lg"
          />
        </div>
      )
    }
    <!-- Contenu de l'article formaté -->
      <article class="prose prose-lg prose-green max-w-none
        prose-headings:text-green-900 prose-headings:font-bold
        prose-h2:text-3xl prose-h2:mt-12 prose-h2:mb-6
        prose-p:text-gray-700 prose-p:leading-relaxed prose-p:mb-6
        prose-ul:my-6 prose-ul:space-y-3
        prose-li:text-gray-700
        prose-strong:text-green-900 prose-strong:font-semibold
      ">
        <Content />
      </article>
    </div>
  </main>
    <div class="mx-auto bg-[#f0f2ee] py-12 px-10">
        <h3 class="text-green-900 text-3xl font-bold">Autres articles</h3>
        <!-- Grille de cards -->
        <div class="py-6">
        <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8" id="cards-grid">
            {autresArticles.map((article) => (
            <a href={`/news/${article.slug}`} class="block group">
                <article
                class="news-card bg-white rounded-3xl overflow-hidden shadow-md hover:shadow-2xl transition-all duration-500 cursor-pointer"
                data-category={article.data.category}
                >
                <!-- Image -->
                <div class="relative h-72 overflow-hidden px-4">
                    <img
                    src={article.data.image}
                    alt={article.data.title}
                    class="w-full rounded-xl h-full object-cover group-hover:scale-110 transition-transform duration-700"
                    />
                </div>

                <!-- Contenu -->
                <div class="p-8">
                    <span class="inline-block text-xs font-semibold text-gray-700 uppercase tracking-wider mb-4">
                    {article.data.category} • {article.data.date}
                    </span>

                    <h3 class="text-xl font-semibold text-green-700 mb-6 leading-snug min-h-[120px]">
                    {article.data.title}
                    </h3>

                    <!-- Bouton remplacé par un simple div pour garder le design -->
                    <div class="flex justify-end">
                    <div
                        class="inline-flex items-center justify-center w-12 h-12 bg-green-50 group-hover:bg-green-700 rounded-full transition-all duration-300"
                        aria-hidden="true"
                    >
                        <GoArrowUpRight className="w-5 h-5 text-green-600 group-hover:text-white" />
                    </div>
                    </div>
                </div>
                </article>
            </a>
            ))}

        </div>
        </div>
    </div>
</Layout>
